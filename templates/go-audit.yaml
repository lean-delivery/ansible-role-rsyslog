---
# Configure socket buffers, \n leave unset to use the system defaults
# Values will be doubled by the kernel
# It is recommended you do not set any of these values unless you really need to
socket_buffer:
  # Default is net.core.rmem_default (/proc/sys/net/core/rmem_default)
  # Maximum max is net.core.rmem_max (/proc/sys/net/core/rmem_max)
  receive: 16384

canary: true

events:
  # Minimum event type to capture, default 1300
  min: 1300
  # Maximum event type to capture, default 1399
  max: 1399

# Configure message sequence tracking
message_tracking:
  # Track messages and identify if we missed any, default true
  enabled: true
  # Log out of orderness, these messages typically signify an overloading system, default false
  log_out_of_order: false
  # Maximum out of orderness before a missed sequence is presumed dropped, default 500
  max_out_of_order: 500

output:
  # Writes logs to syslog
  syslog:
    enabled: true
    attempts: 5
    # Configure the type of socket this should be, default is unixgram
    # This maps to `network` in golangs net.Dial: https://golang.org/pkg/net/#Dial
    network: unixgram
    # Set the remote address to connect to, this can be a path or an ip address
    # This maps to `address` in golangs net.Dial: https://golang.org/pkg/net/#Dial
    # For our SIEM IP consult EPAM SOC
    address: /var/run/go-audit.sock
    # Sets the facility and severity for all events. See the table below for help
    # The default is 132 which maps to local0 | warn
    priority: 132 # local0 | emerg
    # Typically the name of the program generating the message. The PID is of the process is appended for you: [1233]
    # Default value is "go-audit"
    tag: "linux-audit"

rules:
  - -b 1024
  # required if you set canary: true
  - -w /proc/net/netlink -p war -k netlink-file
  # watch interesting network events
  #- -a exit,always -S connect
  - -a exit,always -S listen
  # watch execve for everything that has an auid set (ignores things like cron)
  - -a exit,always -F arch=b64 -F auid!=-1 -S execve -k user_commands
  - -a exit,always -F arch=b32 -F auid!=-1 -S execve -k user_commands
  # failure to access file because of perms
  - -a always,exit -F arch=b32 -S open -S openat -F exit=-EACCES -k access
  - -a always,exit -F arch=b64 -S open -S openat -F exit=-EACCES -k access
  - -a always,exit -F arch=b32 -S open -S openat -F exit=-EPERM -k access
  - -a always,exit -F arch=b64 -S open -S openat -F exit=-EPERM -k access
  ## System startup scripts
  - -w /etc/inittab -p wa -k init
  - -w /etc/init.d/ -p wa -k init
  - -w /etc/init/ -p wa -k init
  # Time
  - -a exit,always -F arch=b32 -S adjtimex -S settimeofday -S clock_settime -k time
  - -a exit,always -F arch=b64 -S adjtimex -S settimeofday -S clock_settime -k time
  - -w /etc/localtime -p wa -k localtime
  # Cron configuration & scheduled jobs
  - -w /etc/cron.allow -p wa -k cron
  - -w /etc/cron.deny -p wa -k cron
  - -w /etc/cron.d/ -p wa -k cron
  - -w /etc/cron.daily/ -p wa -k cron
  - -w /etc/cron.hourly/ -p wa -k cron
  - -w /etc/cron.monthly/ -p wa -k cron
  - -w /etc/cron.weekly/ -p wa -k cron
  - -w /etc/crontab -p wa -k cron
  - -w /var/spool/cron/crontabs/ -k cron
  # Kernel parameters
  - -w /etc/sysctl.conf -p wa -k sysctl
  # Kernel module loading and unloading
  - -a always,exit -F perm=x -F auid!=-1 -F path=/sbin/insmod -k modules
  - -a always,exit -F perm=x -F auid!=-1 -F path=/sbin/modprobe -k modules
  - -a always,exit -F perm=x -F auid!=-1 -F path=/sbin/rmmod -k modules
  - -a always,exit -F arch=b64 -S finit_module -S init_module -S delete_module -F auid!=-1 -k modules
  - -a always,exit -F arch=b32 -S finit_module -S init_module -S delete_module -F auid!=-1 -k modules
  # Modprobe configuration
  - -w /etc/modprobe.conf -p wa -k modprobe
  # KExec usage (all actions)
  - -a always,exit -F arch=b64 -S kexec_load -k KEXEC
  - -a always,exit -F arch=b32 -S sys_kexec_load -k KEXEC
  # Special files
  - -a exit,always -F arch=b32 -S mknod -S mknodat -k specialfiles
  - -a exit,always -F arch=b64 -S mknod -S mknodat -k specialfiles
  # Mount operations (only attributable)
  - -a always,exit -F arch=b64 -S mount -S umount2 -F auid!=-1 -k mount
  - -a always,exit -F arch=b32 -S mount -S umount -S umount2 -F auid!=-1 -k mount
  # DAC permission changes
  # unauthorized file access attempts
  - -a always,exit -F arch=b32 -S chmod -F auid>=500 -F auid!=4294967295 -k perm_mod
  - -a always,exit -F arch=b32 -S chown -F auid>=500 -F auid!=4294967295 -k perm_mod
  - -a always,exit -F arch=b32 -S fchmod -F auid>=500 -F auid!=4294967295 -k perm_mod
  - -a always,exit -F arch=b32 -S fchmodat -F auid>=500 -F auid!=4294967295 -k perm_mod
  - -a always,exit -F arch=b32 -S fchown -F auid>=500 -F auid!=4294967295 -k perm_mod
  - -a always,exit -F arch=b32 -S fchownat -F auid>=500 -F auid!=4294967295 -k perm_mod
  - -a always,exit -F arch=b32 -S fremovexattr -F auid>=500 -F auid!=4294967295 -k perm_mod
  - -a always,exit -F arch=b32 -S fsetxattr -F auid>=500 -F auid!=4294967295 -k perm_mod
  - -a always,exit -F arch=b32 -S lchown -F auid>=500 -F auid!=4294967295 -k perm_mod
  - -a always,exit -F arch=b32 -S lremovexattr -F auid>=500 -F auid!=4294967295 -k perm_mod
  - -a always,exit -F arch=b32 -S lsetxattr -F auid>=500 -F auid!=4294967295 -k perm_mod
  - -a always,exit -F arch=b32 -S removexattr -F auid>=500 -F auid!=4294967295 -k perm_mod
  - -a always,exit -F arch=b32 -S setxattr -F auid>=500 -F auid!=4294967295 -k perm_mod
  - -a always,exit -F arch=b64 -S chmod  -F auid>=500 -F auid!=4294967295 -k perm_mod
  - -a always,exit -F arch=b64 -S chown -F auid>=500 -F auid!=4294967295 -k perm_mod
  - -a always,exit -F arch=b64 -S fchmod -F auid>=500 -F auid!=4294967295 -k perm_mod
  - -a always,exit -F arch=b64 -S fchmodat -F auid>=500 -F auid!=4294967295 -k perm_mod
  - -a always,exit -F arch=b64 -S fchown -F auid>=500 -F auid!=4294967295 -k perm_mod
  - -a always,exit -F arch=b64 -S fchownat -F auid>=500 -F auid!=4294967295 -k perm_mod
  - -a always,exit -F arch=b64 -S fremovexattr -F auid>=500 -F auid!=4294967295 -k perm_mod
  - -a always,exit -F arch=b64 -S fsetxattr -F auid>=500 -F auid!=4294967295 -k perm_mod
  - -a always,exit -F arch=b64 -S lchown -F auid>=500 -F auid!=4294967295 -k perm_mod
  - -a always,exit -F arch=b64 -S lremovexattr -F auid>=500 -F auid!=4294967295 -k perm_mod
  - -a always,exit -F arch=b64 -S lsetxattr -F auid>=500 -F auid!=4294967295 -k perm_mod
  - -a always,exit -F arch=b64 -S removexattr -F auid>=500 -F auid!=4294967295 -k perm_mod
  - -a always,exit -F arch=b64 -S setxattr -F auid>=500 -F auid!=4294967295 -k perm_mod
  ### Unauthorized Access (unsuccessful)
  - -a always,exit -F arch=b32 -S creat -S open -S openat -S open_by_handle_at -S truncate -S ftruncate -F exit=-EACCES -F auid>=500 -F auid!=4294967295 -k file_access
  - -a always,exit -F arch=b32 -S creat -S open -S openat -S open_by_handle_at -S truncate -S ftruncate -F exit=-EPERM -F auid>=500 -F auid!=4294967295 -k file_access
  - -a always,exit -F arch=b64 -S creat -S open -S openat -S open_by_handle_at -S truncate -S ftruncate -F exit=-EACCES -F auid>=500 -F auid!=4294967295 -k file_access
  - -a always,exit -F arch=b64 -S creat -S open -S openat -S open_by_handle_at -S truncate -S ftruncate -F exit=-EPERM -F auid>=500 -F auid!=4294967295 -k file_access
  # Unsuccessful Creation
  - -a always,exit -F arch=b32 -S creat,link,mknod,mkdir,symlink,mknodat,linkat,symlinkat -F exit=-EACCES -k file_creation
  - -a always,exit -F arch=b64 -S mkdir,creat,link,symlink,mknod,mknodat,linkat,symlinkat -F exit=-EACCES -k file_creation
  - -a always,exit -F arch=b32 -S link,mkdir,symlink,mkdirat -F exit=-EPERM -k file_creation
  - -a always,exit -F arch=b64 -S mkdir,link,symlink,mkdirat -F exit=-EPERM -k file_creation
  # Unsuccessful Modification
  - -a always,exit -F arch=b32 -S rename -S renameat -S truncate -S chmod -S setxattr -S lsetxattr -S removexattr -S lremovexattr -F exit=-EACCES -k file_modification
  - -a always,exit -F arch=b64 -S rename -S renameat -S truncate -S chmod -S setxattr -S lsetxattr -S removexattr -S lremovexattr -F exit=-EACCES -k file_modification
  - -a always,exit -F arch=b32 -S rename -S renameat -S truncate -S chmod -S setxattr -S lsetxattr -S removexattr -S lremovexattr -F exit=-EPERM -k file_modification
  - -a always,exit -F arch=b64 -S rename -S renameat -S truncate -S chmod -S setxattr -S lsetxattr -S removexattr -S lremovexattr -F exit=-EPERM -k file_modification
  # Library search paths
  - -w /etc/ld.so.conf -p wa -k libpath
  # User, group, password databases
  - -w /etc/group -p wa -k etcgroup
  - -w /etc/passwd -p wa -k etcpasswd
  - -w /etc/gshadow -k etcgroup
  - -w /etc/shadow -k etcpasswd
  - -w /etc/security/opasswd -k opasswd
  # Sudoers file changes
  - -w /etc/sudoers -p wa -k actions
  # Passwd
  - -w /usr/bin/passwd -p x -k passwd_modification
  # Tools to change group identifiers
  - -w /usr/sbin/groupadd -p x -k group_modification
  - -w /usr/sbin/groupmod -p x -k group_modification
  - -w /usr/sbin/addgroup -p x -k group_modification
  - -w /usr/sbin/useradd -p x -k user_modification
  - -w /usr/sbin/usermod -p x -k user_modification
  - -w /usr/sbin/adduser -p x -k user_modification
  # deleting files
  - -a exit,always -S unlink -S rmdir
  # Pam configuration
  - -w /etc/pam.d/ -p wa -k pam
  - -w /etc/security/limits.conf -p wa  -k pam
  - -w /etc/security/pam_env.conf -p wa -k pam
  - -w /etc/security/namespace.conf -p wa -k pam
  - -w /etc/security/namespace.init -p wa -k pam
  # SELinux events that modify the system's Mandatory Access Controls (MAC)
  - -w /etc/selinux/ -p wa -k mac_policy
  # system administration actions
  # these two lines could be the cause of problems with filling audit logs and preventing system usage after installation
  - -w /var/log/audit/audit.log
  #- -w /var/log/audit/audit[1-4].log
  - -w /var/log/messages
  - -w /etc/go-audit.yaml -p wa -k goauditconf
  - -w /etc/audit/auditd.conf -p wa -k auditconf
  - -w /etc/audit/audit.rules -p wa -k auditrules
  # Systemd
  - -w /bin/systemctl -p x -k systemd
  - -w /etc/systemd/ -p wa -k systemd
  #SSH
  - -w /etc/ssh/sshd_config -k sshd
  # Login configuration and information
  - -w /etc/login.defs -p wa -k login
  - -w /etc/securetty -p wa -k login
  #Record Attempts to Alter Logon and Logout Events
  - -w /var/log/faillog -p wa -k login
  - -w /var/log/lastlog -p wa -k login
  - -w /var/log/tallylog -p wa -k login
  #Record Attempts to Alter Process and Session Initiation Information
  - -w /var/run/utmp -p wa -k session
  - -w /var/log/btmp -p wa -k session
  - -w /var/log/wtmp -p wa -k session
  - -w /etc/sudoers -p rw -k priv_esc
  # These rules watch for code injection by the ptrace facility.
  # This could indicate someone trying to do something bad or just debugging
  - -a always,exit -F arch=b32 -S ptrace -k tracing
  - -a always,exit -F arch=b64 -S ptrace -k tracing
  - -a always,exit -F arch=b32 -S ptrace -F a0=0x4 -k code_injection
  - -a always,exit -F arch=b64 -S ptrace -F a0=0x4 -k code_injection
  - -a always,exit -F arch=b32 -S ptrace -F a0=0x5 -k data_injection
  - -a always,exit -F arch=b64 -S ptrace -F a0=0x5 -k data_injection
  - -a always,exit -F arch=b32 -S ptrace -F a0=0x6 -k register_injection
  - -a always,exit -F arch=b64 -S ptrace -F a0=0x6 -k register_injection
  #The purpose of this rule is to detect when an admin may be abusing power by looking in user's home dir.
  - -a always,exit -F dir=/home -F uid=0 -F auid>=1000 -F auid!=4294967295 -C auid!=obj_uid -k power_abuse
  # Enable kernel auditing (required if not done via the "audit" kernel boot parameter)
  # You can also use this to lock the rules. Locking requires a reboot to modify the ruleset.
  # This should be the last rule in the chain.
  - -e 1

filters:
  # reduce the number of connect syscall events being logged
  - syscall: 42
    message_type: 1306
    # 0200....7F - ipv4 on any port to 127.x.x.x
    # 01 - local/unix domain sockets
    regex: saddr=(0200....7F|01)
